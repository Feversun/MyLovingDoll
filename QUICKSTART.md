# 快速上手指南

## ✅ 编译成功!

ObjectCamp MVP 已经成功编译,现在可以运行测试了。

## 📋 运行前检查清单

### 1. 添加相册权限 (必须!)

在 Xcode 中:
1. 选择项目 → MyLovingDoll target
2. 点击 Info 标签页
3. 添加两个权限说明:

```
NSPhotoLibraryUsageDescription = "需要访问相册以识别和整理您的娃娃照片"
NSPhotoLibraryAddUsageDescription = "需要保存处理后的照片"
```

**或者在 Info.plist 源码中添加:**

```xml
<key>NSPhotoLibraryUsageDescription</key>
<string>需要访问相册以识别和整理您的娃娃照片</string>
<key>NSPhotoLibraryAddUsageDescription</key>
<string>需要保存处理后的照片</string>
```

### 2. 连接真机设备

Vision 框架的主体识别功能在真机上表现最佳,建议使用 iPhone(iOS 17+)进行测试。

### 3. 准备测试照片

在相册中准备几张:
- ✅ 背景简单的娃娃照片
- ✅ 清晰的前景对象
- ✅ 同一个娃娃的多张照片(测试聚类)
- ❌ 避免复杂背景或模糊照片

## 🚀 首次运行流程

1. **启动应用**
   - 会看到 ObjectCamp 欢迎界面
   - 粉色照片图标和标题

2. **选择照片**
   - 点击"选择照片"按钮
   - 首次使用会请求相册权限 → 点击"允许"
   - 在照片选择器中选择 5-10 张娃娃照片
   - 点击"完成"

3. **开始整理**
   - 点击"开始整理"按钮
   - 会显示处理进度条
   - 等待处理完成(5 张照片约 10-30 秒)

4. **查看结果**
   - 处理完成后,点击"已整理 X 个对象"
   - 进入对象库网格视图
   - 每个卡片代表一个识别出的娃娃

5. **查看详情**
   - 点击任意对象卡片
   - 查看该对象的所有照片
   - 可以重命名、拆分或标记非目标

## 🎯 功能测试清单

### 基础功能
- [ ] 选择照片成功
- [ ] 处理进度正常显示
- [ ] 主体提取成功(生成贴纸)
- [ ] 对象库显示识别结果

### 聚类测试
- [ ] 同一娃娃的照片被分到一组
- [ ] 不同娃娃被分到不同组
- [ ] 数量徽标显示正确

### 详情页测试
- [ ] 查看对象所有照片
- [ ] 重命名对象
- [ ] 选择照片
- [ ] 拆分选中照片到新对象
- [ ] 标记照片为非目标

### 数据管理
- [ ] 设置页面清空数据
- [ ] 重新整理照片

## 🐛 常见问题排查

### 问题 1: 没有识别出主体
**原因**: 照片背景复杂或前景不清晰
**解决**: 尝试背景简单、对象清晰的照片

### 问题 2: 聚类不准确
**原因**: 相似度阈值不适合当前照片
**解决**: 在 `EntityClusterService.swift` 第 17 行调整 `similarityThreshold` 值
- 当前值: 0.75
- 更严格(减少误分): 0.80-0.85
- 更宽松(减少漏分): 0.65-0.70

### 问题 3: 处理速度慢
**原因**: Vision 处理需要时间
**解决**: 
- 减少一次处理的照片数量
- 在处理过程中可以查看已完成的结果

### 问题 4: 应用闪退
**原因**: 可能是内存问题
**解决**: 
- 重启应用
- 减少照片数量
- 检查 Xcode 控制台日志

## 📊 性能参考

| 照片数量 | 预计处理时间 | 内存占用 |
|---------|------------|---------|
| 5 张    | 10-30 秒   | ~150MB  |
| 10 张   | 30-60 秒   | ~200MB  |
| 20 张   | 1-2 分钟   | ~300MB  |

## 🔧 调试建议

### 查看日志
在 Xcode 控制台观察:
- 主体提取成功/失败日志
- 特征向量提取日志
- 聚类过程日志

### 检查文件
使用 Xcode → Window → Devices and Simulators 查看应用容器:
```
Documents/ObjectCamp/doll/
├── subjects/    # 提取的贴纸
└── thumbnails/  # 缩略图
```

### 检查数据库
SwiftData 数据存储在:
```
Library/Application Support/default.store
```

## ✨ 下一步

测试完成后,可以继续开发:
1. **相册选择器** - 支持选择整个相册
2. **批量操作** - 合并多个对象
3. **AI 生成** - 接入 nano banana API
4. **娃娃档案** - 建立完整的 MyLovingDoll 功能

---

**祝测试顺利!** 🎊

如有问题,请查看详细文档: [SETUP.md](SETUP.md)
